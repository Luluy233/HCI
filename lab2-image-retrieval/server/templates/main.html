
<!DOCTYPE html>
<html>
<head>
<title>Image Search Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<meta http-equiv='cache-control' content="no-cache, must-revalidate, post-check=0, pre-check=0">
<meta http-equiv='expires' content='0'>
<meta http-equiv='pragma' content='no-cache'>

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>

</head>

<body>
    
    <!-- 标题栏 -->
    <div class="navbar">
        <h1 class="text-center">
            &nbsp;&nbsp;
            <b>IMAGE SEARCH</b>
            &nbsp;&nbsp;
            <a class="navbar-brand" href="">
            <img src="/images/logo.svg"></a>
        </h1>
    </div>
    <div>
    </div>
	
    <center></center>	
    
    <!-- 搜索框 -->
    <div id="main" class="container">
        <table class="table">
            <!-- 标题栏 -->
             <tr class="title">
                <td>
                    <b>Chose your file to upload</b>
                </td>
                <td><b></b></td>
            </tr>
            <!-- 按钮设置 -->
            <tr>
                <td>
                    <form method=post enctype=multipart/form-data>
                        <!--<input data-bind="value: title" type="text" id="inputTask" placeholder="Path to the image" style="width: 150px;">-->
                        <div class="select" >
                            <input id="file_input" type="file" name="file" onchange="FileUpload()" required />
                            <img id="selectImg" src="" >
                            
                        </div>
                        <!-- <div class="upload-box">
                            <input type="file" id="file-input">
                            <img id="uploaded-image">
                          </div> -->
                        <div>
                            <input class="search" type=submit value ="" onclick="fun()"> 
                        </div>       
                             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
                    </form>
                </td>
                <td><b></b></td>
            </tr>
            <tr id="row1">
                <td>
                    <div class="tag">
                        <!-- <button id="tag0"></button>
                        <button id="tag1"></button>
                        <button id="tag2"></button>
                        <button id="tag3"></button>
                        <button id="tag4"></button> -->
                    </div>
                    
                    <a href="">
                        <span>为您找到结果共9条</span>
                        <button id="clear">Clear</button>  
                    </a>
                </td>
                <td></td>   
            </tr>
        </table>       
    </div>

     <!-- 加载标志 -->
    <center>
    <img id="load" src="/images/ajax-loader.gif"  >
    </center>

    <!-- 搜索结果 -->
    <div id="main" class="container">
       <table id="table" class="table" style="background: white; border: 1px ;display:none;" >
        <tbody>
            <tr>
                <td>
                    <img id="img0" src="" alt="Norway" width="200" height="200">
                </td>  
                <td>
    		        <img id="img1" src="" alt="Norway" width="200" height="200">
                </td>
                <td>
    		        <img id="img2" src="" alt="Norway" width="200" height="200">
                </td>
            </tr>
            <tr>
                <td>
                    <img id="img3" src="" alt="Norway" width="200" height="200">
                </td>
                <td>
                    <img id="img4" src="" alt="Norway" width="200" height="200">
                </td>
                <td>
                    <img id="img5" src="" alt="Norway" width="200" height="200">
                </td>
            </tr>
            <tr>
                <td>
                    <img id="img6" src="" alt="Norway" width="200" height="200">
                </td>
                <td>
                    <img id="img7" src="" alt="Norway" width="200" height="200">
                </td>
                <td>
                    <img id="img8" src="" alt="Norway" width="200" height="200">
                </td>
            </tr>
            
        </tbody>
       </table>



    </div>
	
    <!-- js -->
    <script type="text/javascript">
        // <!-- 图片标签 -->
        tags = ['animals', 'baby', 'bird', 'car', 'clouds', 'dog', 'female',
            'flower', 'food', 'indoor', 'lake', 'male', 'night', 'people',
            'plant_life', 'portrait', 'river', 'sea', 'structures', 'sunset',
            'transport', 'tree', 'water'];

        // // 显示上传的图片
        // function xmTanUploadImg(obj) {
        //     var file = obj.files[0];
        //     var reader = new FileReader();
        //     reader.readAsDataURL(file);
        //     reader.onload = function (e) {    //成功读取文件
        //         var img = document.getElementById("selectImg");
        //         img.src = e.target.result;   //或 img.src = this.result / e.target == this
        //     };
        // }


        function myFunction(){
            document.getElementById("predictedResult").innerHTML= "";
            $('#clear').hide();
        }

                // 显示上传的图片
        function FileUpload()
        {
            var fileInput = document.getElementById('file_input');
            var uploadedImage = document.getElementById('selectImg');

            fileInput.addEventListener('change', (event) => {
            var file = event.target.files[0];
            var reader = new FileReader();
  
            reader.readAsDataURL(file);
  
            reader.onload = () => {
                uploadedImage.src = reader.result;
                uploadedImage.style.display = 'block';
            }
        });
        }
        
        function fun(){
            
            $('#load').show();
                    
            $("form").submit(function(evt){	 
            //$('#loader-icon').show(); 
                        
            evt.preventDefault();
            
                    //$('#loader-icon').show();
                var formData = new FormData($(this)[0]);
            
            $.ajax({
                // 发出请求的路由
                url: 'imgUpload',
                type: 'POST',
                data: formData,
                //async: false,
                cache: false,
                contentType: false,
                enctype: 'multipart/form-data',
                processData: false,
            
                success: function (response) {
                    $('#load').hide();
                     $('#row1').show();
                    //$('#clear').show();
                    //console.log(response[1]);
                      //document.getElementById("predictedResult").innerHTML= response; 
                    document.getElementById("img0").src = response.images.image0;
                    document.getElementById("img1").src = response.images.image1;
                    document.getElementById("img2").src = response.images.image2;
                    document.getElementById("img3").src = response.images.image3;
                    document.getElementById("img4").src = response.images.image4;
                    document.getElementById("img5").src = response.images.image5;
                    document.getElementById("img6").src = response.images.image6;
                    document.getElementById("img7").src = response.images.image7;
                    document.getElementById("img8").src = response.images.image8;

                    const labelsContainer = document.querySelector('.tag');
      
                    // 动态创建并添加标签元素
                    response.upload_tag.forEach(tag => {
                        const span = document.createElement('span');
                        span.textContent = tag;
                        span.classList.add('label');
                        // span.classList.add(`label-${tag}`);
                        labelsContainer.appendChild(span);
                    });

                    // for (var i=0;i<response.upload_tag.length;i++){
                    //     console.log(response.upload_tag[i])
                    //         document.getElementById("tag"+i).innerHTML=response.upload_tag[i];
                    // }
                    
                    $('#table').show();
                    $('#clear').show();
                }

            });

        return false;
        })};

        
        
    </script>

</body>
</html>
